{
    "version": 3,
    "terraform_version": "0.11.7",
    "serial": 36,
    "lineage": "152c1969-aa21-c1dc-b003-ca0623c92abd",
    "modules": [
        {
            "path": [
                "root"
            ],
            "outputs": {},
            "resources": {
                "aws_instance.k8_master": {
                    "type": "aws_instance",
                    "depends_on": [
                        "aws_security_group.k8_master",
                        "aws_subnet.k8_public_subnet",
                        "data.template_file.k8_master"
                    ],
                    "primary": {
                        "id": "i-09764c551fdcd029e",
                        "attributes": {
                            "ami": "ami-0427e8367e3770df1",
                            "arn": "arn:aws:ec2:ca-central-1:584643220196:instance/i-09764c551fdcd029e",
                            "associate_public_ip_address": "true",
                            "availability_zone": "ca-central-1a",
                            "cpu_core_count": "2",
                            "cpu_threads_per_core": "1",
                            "credit_specification.#": "1",
                            "credit_specification.0.cpu_credits": "standard",
                            "disable_api_termination": "false",
                            "ebs_block_device.#": "0",
                            "ebs_optimized": "false",
                            "ephemeral_block_device.#": "0",
                            "get_password_data": "false",
                            "iam_instance_profile": "",
                            "id": "i-09764c551fdcd029e",
                            "instance_state": "running",
                            "instance_type": "t2.large",
                            "ipv6_addresses.#": "0",
                            "key_name": "caneda",
                            "monitoring": "false",
                            "network_interface.#": "0",
                            "network_interface_id": "eni-04e643c81fd579c96",
                            "password_data": "",
                            "placement_group": "",
                            "primary_network_interface_id": "eni-04e643c81fd579c96",
                            "private_dns": "ip-10-16-31-101.ca-central-1.compute.internal",
                            "private_ip": "10.16.31.101",
                            "public_dns": "",
                            "public_ip": "99.79.45.252",
                            "root_block_device.#": "1",
                            "root_block_device.0.delete_on_termination": "true",
                            "root_block_device.0.iops": "100",
                            "root_block_device.0.volume_id": "vol-00b14a02049aa60f9",
                            "root_block_device.0.volume_size": "8",
                            "root_block_device.0.volume_type": "gp2",
                            "security_groups.#": "0",
                            "source_dest_check": "true",
                            "subnet_id": "subnet-08c9206bccc1e10ac",
                            "tags.%": "1",
                            "tags.Name": "K8-Master",
                            "tenancy": "default",
                            "user_data": "ce724e1edece4dd1fc52a7f700f5f5a6b315810a",
                            "volume_tags.%": "0",
                            "vpc_security_group_ids.#": "1",
                            "vpc_security_group_ids.328806580": "sg-0e3238cf90c4e269f"
                        },
                        "meta": {
                            "e2bfb730-ecaa-11e6-8f88-34363bc7c4c0": {
                                "create": 600000000000,
                                "delete": 1200000000000,
                                "update": 600000000000
                            },
                            "schema_version": "1"
                        },
                        "tainted": false
                    },
                    "deposed": [],
                    "provider": "provider.aws"
                },
                "aws_instance.k8_node.0": {
                    "type": "aws_instance",
                    "depends_on": [
                        "aws_instance.k8_master",
                        "aws_security_group.k8_node",
                        "aws_subnet.k8_public_subnet",
                        "data.template_file.k8_node"
                    ],
                    "primary": {
                        "id": "i-000a3851211223acf",
                        "attributes": {
                            "ami": "ami-0427e8367e3770df1",
                            "arn": "arn:aws:ec2:ca-central-1:584643220196:instance/i-000a3851211223acf",
                            "associate_public_ip_address": "true",
                            "availability_zone": "ca-central-1a",
                            "cpu_core_count": "2",
                            "cpu_threads_per_core": "1",
                            "credit_specification.#": "1",
                            "credit_specification.0.cpu_credits": "standard",
                            "disable_api_termination": "false",
                            "ebs_block_device.#": "0",
                            "ebs_optimized": "false",
                            "ephemeral_block_device.#": "0",
                            "get_password_data": "false",
                            "iam_instance_profile": "",
                            "id": "i-000a3851211223acf",
                            "instance_state": "running",
                            "instance_type": "t2.large",
                            "ipv6_addresses.#": "0",
                            "key_name": "caneda",
                            "monitoring": "false",
                            "network_interface.#": "0",
                            "network_interface_id": "eni-04489c65ad16276c6",
                            "password_data": "",
                            "placement_group": "",
                            "primary_network_interface_id": "eni-04489c65ad16276c6",
                            "private_dns": "ip-10-16-31-29.ca-central-1.compute.internal",
                            "private_ip": "10.16.31.29",
                            "public_dns": "",
                            "public_ip": "35.182.253.230",
                            "root_block_device.#": "1",
                            "root_block_device.0.delete_on_termination": "true",
                            "root_block_device.0.iops": "100",
                            "root_block_device.0.volume_id": "vol-00e669398f70e965f",
                            "root_block_device.0.volume_size": "8",
                            "root_block_device.0.volume_type": "gp2",
                            "security_groups.#": "0",
                            "source_dest_check": "true",
                            "subnet_id": "subnet-08c9206bccc1e10ac",
                            "tags.%": "1",
                            "tags.Name": "K8-Node-0",
                            "tenancy": "default",
                            "user_data": "f565927cfbf00fba486d39974ecff99c9b42d308",
                            "volume_tags.%": "0",
                            "vpc_security_group_ids.#": "1",
                            "vpc_security_group_ids.1843489699": "sg-055b74981fc4cedb8"
                        },
                        "meta": {
                            "e2bfb730-ecaa-11e6-8f88-34363bc7c4c0": {
                                "create": 600000000000,
                                "delete": 1200000000000,
                                "update": 600000000000
                            },
                            "schema_version": "1"
                        },
                        "tainted": false
                    },
                    "deposed": [],
                    "provider": "provider.aws"
                },
                "aws_instance.k8_node.1": {
                    "type": "aws_instance",
                    "depends_on": [
                        "aws_instance.k8_master",
                        "aws_security_group.k8_node",
                        "aws_subnet.k8_public_subnet",
                        "data.template_file.k8_node"
                    ],
                    "primary": {
                        "id": "i-036147a3cec07e9fd",
                        "attributes": {
                            "ami": "ami-0427e8367e3770df1",
                            "arn": "arn:aws:ec2:ca-central-1:584643220196:instance/i-036147a3cec07e9fd",
                            "associate_public_ip_address": "true",
                            "availability_zone": "ca-central-1a",
                            "cpu_core_count": "2",
                            "cpu_threads_per_core": "1",
                            "credit_specification.#": "1",
                            "credit_specification.0.cpu_credits": "standard",
                            "disable_api_termination": "false",
                            "ebs_block_device.#": "0",
                            "ebs_optimized": "false",
                            "ephemeral_block_device.#": "0",
                            "get_password_data": "false",
                            "iam_instance_profile": "",
                            "id": "i-036147a3cec07e9fd",
                            "instance_state": "running",
                            "instance_type": "t2.large",
                            "ipv6_addresses.#": "0",
                            "key_name": "caneda",
                            "monitoring": "false",
                            "network_interface.#": "0",
                            "network_interface_id": "eni-0c7d39208f7144226",
                            "password_data": "",
                            "placement_group": "",
                            "primary_network_interface_id": "eni-0c7d39208f7144226",
                            "private_dns": "ip-10-16-31-4.ca-central-1.compute.internal",
                            "private_ip": "10.16.31.4",
                            "public_dns": "",
                            "public_ip": "35.183.120.21",
                            "root_block_device.#": "1",
                            "root_block_device.0.delete_on_termination": "true",
                            "root_block_device.0.iops": "100",
                            "root_block_device.0.volume_id": "vol-07c9dce11d2cfcec0",
                            "root_block_device.0.volume_size": "8",
                            "root_block_device.0.volume_type": "gp2",
                            "security_groups.#": "0",
                            "source_dest_check": "true",
                            "subnet_id": "subnet-08c9206bccc1e10ac",
                            "tags.%": "1",
                            "tags.Name": "K8-Node-1",
                            "tenancy": "default",
                            "user_data": "f565927cfbf00fba486d39974ecff99c9b42d308",
                            "volume_tags.%": "0",
                            "vpc_security_group_ids.#": "1",
                            "vpc_security_group_ids.1843489699": "sg-055b74981fc4cedb8"
                        },
                        "meta": {
                            "e2bfb730-ecaa-11e6-8f88-34363bc7c4c0": {
                                "create": 600000000000,
                                "delete": 1200000000000,
                                "update": 600000000000
                            },
                            "schema_version": "1"
                        },
                        "tainted": false
                    },
                    "deposed": [],
                    "provider": "provider.aws"
                },
                "aws_internet_gateway.k8-igw": {
                    "type": "aws_internet_gateway",
                    "depends_on": [
                        "aws_vpc.k8_vpc"
                    ],
                    "primary": {
                        "id": "igw-05a0369f86d3a7ef2",
                        "attributes": {
                            "id": "igw-05a0369f86d3a7ef2",
                            "owner_id": "584643220196",
                            "tags.%": "1",
                            "tags.Name": "K8-IGW",
                            "vpc_id": "vpc-0005225ef9b277d30"
                        },
                        "meta": {},
                        "tainted": false
                    },
                    "deposed": [],
                    "provider": "provider.aws"
                },
                "aws_route_table.k8_public_subnet": {
                    "type": "aws_route_table",
                    "depends_on": [
                        "aws_internet_gateway.k8-igw",
                        "aws_vpc.k8_vpc"
                    ],
                    "primary": {
                        "id": "rtb-0e0be02ce41996d28",
                        "attributes": {
                            "id": "rtb-0e0be02ce41996d28",
                            "owner_id": "584643220196",
                            "propagating_vgws.#": "0",
                            "route.#": "1",
                            "route.2960461685.cidr_block": "0.0.0.0/0",
                            "route.2960461685.egress_only_gateway_id": "",
                            "route.2960461685.gateway_id": "igw-05a0369f86d3a7ef2",
                            "route.2960461685.instance_id": "",
                            "route.2960461685.ipv6_cidr_block": "",
                            "route.2960461685.nat_gateway_id": "",
                            "route.2960461685.network_interface_id": "",
                            "route.2960461685.transit_gateway_id": "",
                            "route.2960461685.vpc_peering_connection_id": "",
                            "tags.%": "1",
                            "tags.Name": "K8-public-subnet-routing-table",
                            "vpc_id": "vpc-0005225ef9b277d30"
                        },
                        "meta": {},
                        "tainted": false
                    },
                    "deposed": [],
                    "provider": "provider.aws"
                },
                "aws_route_table_association.k8_public_subnet": {
                    "type": "aws_route_table_association",
                    "depends_on": [
                        "aws_route_table.k8_public_subnet",
                        "aws_subnet.k8_public_subnet"
                    ],
                    "primary": {
                        "id": "rtbassoc-0b074e2b47b58d740",
                        "attributes": {
                            "id": "rtbassoc-0b074e2b47b58d740",
                            "route_table_id": "rtb-0e0be02ce41996d28",
                            "subnet_id": "subnet-08c9206bccc1e10ac"
                        },
                        "meta": {},
                        "tainted": false
                    },
                    "deposed": [],
                    "provider": "provider.aws"
                },
                "aws_security_group.k8_master": {
                    "type": "aws_security_group",
                    "depends_on": [
                        "aws_vpc.k8_vpc"
                    ],
                    "primary": {
                        "id": "sg-0e3238cf90c4e269f",
                        "attributes": {
                            "arn": "arn:aws:ec2:ca-central-1:584643220196:security-group/sg-0e3238cf90c4e269f",
                            "description": "K8 master node sg",
                            "egress.#": "1",
                            "egress.482069346.cidr_blocks.#": "1",
                            "egress.482069346.cidr_blocks.0": "0.0.0.0/0",
                            "egress.482069346.description": "",
                            "egress.482069346.from_port": "0",
                            "egress.482069346.ipv6_cidr_blocks.#": "0",
                            "egress.482069346.prefix_list_ids.#": "0",
                            "egress.482069346.protocol": "-1",
                            "egress.482069346.security_groups.#": "0",
                            "egress.482069346.self": "false",
                            "egress.482069346.to_port": "0",
                            "id": "sg-0e3238cf90c4e269f",
                            "ingress.#": "1",
                            "ingress.482069346.cidr_blocks.#": "1",
                            "ingress.482069346.cidr_blocks.0": "0.0.0.0/0",
                            "ingress.482069346.description": "",
                            "ingress.482069346.from_port": "0",
                            "ingress.482069346.ipv6_cidr_blocks.#": "0",
                            "ingress.482069346.prefix_list_ids.#": "0",
                            "ingress.482069346.protocol": "-1",
                            "ingress.482069346.security_groups.#": "0",
                            "ingress.482069346.self": "false",
                            "ingress.482069346.to_port": "0",
                            "name": "k8_master_sg",
                            "owner_id": "584643220196",
                            "revoke_rules_on_delete": "false",
                            "tags.%": "0",
                            "vpc_id": "vpc-0005225ef9b277d30"
                        },
                        "meta": {
                            "e2bfb730-ecaa-11e6-8f88-34363bc7c4c0": {
                                "create": 600000000000,
                                "delete": 600000000000
                            },
                            "schema_version": "1"
                        },
                        "tainted": false
                    },
                    "deposed": [],
                    "provider": "provider.aws"
                },
                "aws_security_group.k8_node": {
                    "type": "aws_security_group",
                    "depends_on": [
                        "aws_vpc.k8_vpc"
                    ],
                    "primary": {
                        "id": "sg-055b74981fc4cedb8",
                        "attributes": {
                            "arn": "arn:aws:ec2:ca-central-1:584643220196:security-group/sg-055b74981fc4cedb8",
                            "description": "K8 node sg",
                            "egress.#": "1",
                            "egress.482069346.cidr_blocks.#": "1",
                            "egress.482069346.cidr_blocks.0": "0.0.0.0/0",
                            "egress.482069346.description": "",
                            "egress.482069346.from_port": "0",
                            "egress.482069346.ipv6_cidr_blocks.#": "0",
                            "egress.482069346.prefix_list_ids.#": "0",
                            "egress.482069346.protocol": "-1",
                            "egress.482069346.security_groups.#": "0",
                            "egress.482069346.self": "false",
                            "egress.482069346.to_port": "0",
                            "id": "sg-055b74981fc4cedb8",
                            "ingress.#": "1",
                            "ingress.482069346.cidr_blocks.#": "1",
                            "ingress.482069346.cidr_blocks.0": "0.0.0.0/0",
                            "ingress.482069346.description": "",
                            "ingress.482069346.from_port": "0",
                            "ingress.482069346.ipv6_cidr_blocks.#": "0",
                            "ingress.482069346.prefix_list_ids.#": "0",
                            "ingress.482069346.protocol": "-1",
                            "ingress.482069346.security_groups.#": "0",
                            "ingress.482069346.self": "false",
                            "ingress.482069346.to_port": "0",
                            "name": "k8_node_sg",
                            "owner_id": "584643220196",
                            "revoke_rules_on_delete": "false",
                            "tags.%": "0",
                            "vpc_id": "vpc-0005225ef9b277d30"
                        },
                        "meta": {
                            "e2bfb730-ecaa-11e6-8f88-34363bc7c4c0": {
                                "create": 600000000000,
                                "delete": 600000000000
                            },
                            "schema_version": "1"
                        },
                        "tainted": false
                    },
                    "deposed": [],
                    "provider": "provider.aws"
                },
                "aws_subnet.k8_public_subnet": {
                    "type": "aws_subnet",
                    "depends_on": [
                        "aws_vpc.k8_vpc"
                    ],
                    "primary": {
                        "id": "subnet-08c9206bccc1e10ac",
                        "attributes": {
                            "arn": "arn:aws:ec2:ca-central-1:584643220196:subnet/subnet-08c9206bccc1e10ac",
                            "assign_ipv6_address_on_creation": "false",
                            "availability_zone": "ca-central-1a",
                            "availability_zone_id": "cac1-az1",
                            "cidr_block": "10.16.31.0/24",
                            "id": "subnet-08c9206bccc1e10ac",
                            "ipv6_cidr_block": "",
                            "ipv6_cidr_block_association_id": "",
                            "map_public_ip_on_launch": "true",
                            "owner_id": "584643220196",
                            "tags.%": "1",
                            "tags.Name": "K8-public-subnet",
                            "vpc_id": "vpc-0005225ef9b277d30"
                        },
                        "meta": {
                            "e2bfb730-ecaa-11e6-8f88-34363bc7c4c0": {
                                "create": 600000000000,
                                "delete": 600000000000
                            },
                            "schema_version": "1"
                        },
                        "tainted": false
                    },
                    "deposed": [],
                    "provider": "provider.aws"
                },
                "aws_vpc.k8_vpc": {
                    "type": "aws_vpc",
                    "depends_on": [],
                    "primary": {
                        "id": "vpc-0005225ef9b277d30",
                        "attributes": {
                            "arn": "arn:aws:ec2:ca-central-1:584643220196:vpc/vpc-0005225ef9b277d30",
                            "assign_generated_ipv6_cidr_block": "false",
                            "cidr_block": "10.16.0.0/16",
                            "default_network_acl_id": "acl-0475de0c79ed89760",
                            "default_route_table_id": "rtb-0b6729b84e92a6e98",
                            "default_security_group_id": "sg-0394e27456c785a8f",
                            "dhcp_options_id": "dopt-2797d94e",
                            "enable_dns_hostnames": "false",
                            "enable_dns_support": "true",
                            "id": "vpc-0005225ef9b277d30",
                            "instance_tenancy": "default",
                            "ipv6_association_id": "",
                            "ipv6_cidr_block": "",
                            "main_route_table_id": "rtb-0b6729b84e92a6e98",
                            "owner_id": "584643220196",
                            "tags.%": "1",
                            "tags.Name": "K8-VPC"
                        },
                        "meta": {
                            "schema_version": "1"
                        },
                        "tainted": false
                    },
                    "deposed": [],
                    "provider": "provider.aws"
                },
                "data.template_file.k8_master": {
                    "type": "template_file",
                    "depends_on": [],
                    "primary": {
                        "id": "0692316cc662c2c04f6617b9cb7933d8726ad48d8c37d45aa0cd435c7e058997",
                        "attributes": {
                            "id": "0692316cc662c2c04f6617b9cb7933d8726ad48d8c37d45aa0cd435c7e058997",
                            "rendered": "#!/bin/bash\r\n\r\napt update\r\napt install apt-transport-https ca-certificates curl gnupg-agent software-properties-common -y\r\n\r\n# add dependencies\r\ncurl -s https://packages.cloud.google.com/apt/doc/apt-key.gpg | apt-key add -\r\necho \"deb http://apt.kubernetes.io/ kubernetes-xenial main\" \u003e /etc/apt/sources.list.d/kubernetes.list\r\n\r\ncurl -fsSL https://download.docker.com/linux/ubuntu/gpg | apt-key add -\r\nadd-apt-repository \"deb [arch=amd64] https://download.docker.com/linux/ubuntu    $(lsb_release -cs)    stable\"\r\n\r\n# install docker\r\napt update\r\napt install -y 'docker-ce=18.06.1~ce~3-0~ubuntu'\r\napt install docker-ce-cli containerd.io -y\r\nsystemctl start docker\r\nsystemctl enable docker\r\n\r\n# install kubernetes\r\napt install -y kubelet kubeadm kubectl kubernetes-cni\r\nsystemctl start kubelet\r\nsystemctl enable kubelet\r\n\r\n# initialize cluster\r\nkubeadm init --token abcdef.0123456789abcdef --pod-network-cidr 192.168.1.0/24\r\n\r\n# install pod network plugin\r\nkubectl apply -f https://raw.githubusercontent.com/coreos/flannel/master/Documentation/kube-flannel.yml\r\nkubectl apply -f https://raw.githubusercontent.com/coreos/flannel/master/Documentation/k8s-manifests/kube-flannel-rbac.yml\r\n# kubectl apply -f \"https://cloud.weave.works/k8s/net?k8s-version=$(kubectl version | base64 | tr -d '\\n')\"\r\nmkdir -p /etc/cni/net.d \r\ncat \u003e /etc/cni/net.d/10-flannel.conflist \u003c\u003cEOF \r\n{ \"name\": \"cbr0\", \"plugins\": [ { \"type\": \"flannel\", \"delegate\": { \"hairpinMode\": true, \"isDefaultGateway\": true } }, { \"type\": \"portmap\", \"capabilities\": { \"portMappings\": true } } ] }\r\nEOF\r\n\r\n\r\n# configure kubectl for user ubuntu \r\nmkdir -p /home/ubuntu/.kube\r\ncp -i /etc/kubernetes/admin.conf /home/ubuntu/.kube/config\r\nchown -R ubuntu:ubuntu /home/ubuntu/.kube\r\n\r\nsystemctl restart docker kubelet\r\n",
                            "template": "#!/bin/bash\r\n\r\napt update\r\napt install apt-transport-https ca-certificates curl gnupg-agent software-properties-common -y\r\n\r\n# add dependencies\r\ncurl -s https://packages.cloud.google.com/apt/doc/apt-key.gpg | apt-key add -\r\necho \"deb http://apt.kubernetes.io/ kubernetes-xenial main\" \u003e /etc/apt/sources.list.d/kubernetes.list\r\n\r\ncurl -fsSL https://download.docker.com/linux/ubuntu/gpg | apt-key add -\r\nadd-apt-repository \"deb [arch=amd64] https://download.docker.com/linux/ubuntu    $(lsb_release -cs)    stable\"\r\n\r\n# install docker\r\napt update\r\napt install -y 'docker-ce=18.06.1~ce~3-0~ubuntu'\r\napt install docker-ce-cli containerd.io -y\r\nsystemctl start docker\r\nsystemctl enable docker\r\n\r\n# install kubernetes\r\napt install -y kubelet kubeadm kubectl kubernetes-cni\r\nsystemctl start kubelet\r\nsystemctl enable kubelet\r\n\r\n# initialize cluster\r\nkubeadm init --token ${KUBEADM_TOKEN} --pod-network-cidr 192.168.1.0/24\r\n\r\n# install pod network plugin\r\nkubectl apply -f https://raw.githubusercontent.com/coreos/flannel/master/Documentation/kube-flannel.yml\r\nkubectl apply -f https://raw.githubusercontent.com/coreos/flannel/master/Documentation/k8s-manifests/kube-flannel-rbac.yml\r\n# kubectl apply -f \"https://cloud.weave.works/k8s/net?k8s-version=$(kubectl version | base64 | tr -d '\\n')\"\r\nmkdir -p /etc/cni/net.d \r\ncat \u003e /etc/cni/net.d/10-flannel.conflist \u003c\u003cEOF \r\n{ \"name\": \"cbr0\", \"plugins\": [ { \"type\": \"flannel\", \"delegate\": { \"hairpinMode\": true, \"isDefaultGateway\": true } }, { \"type\": \"portmap\", \"capabilities\": { \"portMappings\": true } } ] }\r\nEOF\r\n\r\n\r\n# configure kubectl for user ubuntu \r\nmkdir -p /home/ubuntu/.kube\r\ncp -i /etc/kubernetes/admin.conf /home/ubuntu/.kube/config\r\nchown -R ubuntu:ubuntu /home/ubuntu/.kube\r\n\r\nsystemctl restart docker kubelet\r\n",
                            "vars.%": "1",
                            "vars.KUBEADM_TOKEN": "abcdef.0123456789abcdef"
                        },
                        "meta": {},
                        "tainted": false
                    },
                    "deposed": [],
                    "provider": "provider.template"
                },
                "data.template_file.k8_node": {
                    "type": "template_file",
                    "depends_on": [
                        "aws_instance.k8_master"
                    ],
                    "primary": {
                        "id": "21d2cdd90bb0b7c082498161720accea9328b6395e23bd7b6d74df7c7a05d7b6",
                        "attributes": {
                            "id": "21d2cdd90bb0b7c082498161720accea9328b6395e23bd7b6d74df7c7a05d7b6",
                            "rendered": "#!/bin/bash\r\n\r\napt update\r\napt install apt-transport-https ca-certificates curl gnupg-agent software-properties-common -y\r\n\r\n# add repositories\r\ncurl -s https://packages.cloud.google.com/apt/doc/apt-key.gpg | apt-key add -\r\necho \"deb http://apt.kubernetes.io/ kubernetes-xenial main\" \u003e /etc/apt/sources.list.d/kubernetes.list\r\n\r\ncurl -fsSL https://download.docker.com/linux/ubuntu/gpg | apt-key add -\r\nadd-apt-repository \"deb [arch=amd64] https://download.docker.com/linux/ubuntu    $(lsb_release -cs)    stable\"\r\n\r\n# install docker\r\napt update\r\napt install 'docker-ce=18.06.1~ce~3-0~ubuntu' -y\r\napt install docker-ce-cli containerd.io -y\r\nsystemctl start docker\r\nsystemctl enable docker\r\n\r\n# install kubernetes\r\napt install -y kubelet kubeadm kubectl kubernetes-cni\r\nmkdir -p /etc/cni/net.d \r\ncat \u003e /etc/cni/net.d/10-flannel.conflist \u003c\u003cEOF \r\n{ \"name\": \"cbr0\", \"plugins\": [ { \"type\": \"flannel\", \"delegate\": { \"hairpinMode\": true, \"isDefaultGateway\": true } }, { \"type\": \"portmap\", \"capabilities\": { \"portMappings\": true } } ] }\r\nEOF\r\nsystemctl start kubelet\r\nsystemctl enable kubelet\r\n\r\n# join nodes to cluster\r\nkubeadm join --token abcdef.0123456789abcdef 99.79.45.252:6443 --discovery-token-unsafe-skip-ca-verification\r\n\r\nsystemctl restart kubelet",
                            "template": "#!/bin/bash\r\n\r\napt update\r\napt install apt-transport-https ca-certificates curl gnupg-agent software-properties-common -y\r\n\r\n# add repositories\r\ncurl -s https://packages.cloud.google.com/apt/doc/apt-key.gpg | apt-key add -\r\necho \"deb http://apt.kubernetes.io/ kubernetes-xenial main\" \u003e /etc/apt/sources.list.d/kubernetes.list\r\n\r\ncurl -fsSL https://download.docker.com/linux/ubuntu/gpg | apt-key add -\r\nadd-apt-repository \"deb [arch=amd64] https://download.docker.com/linux/ubuntu    $(lsb_release -cs)    stable\"\r\n\r\n# install docker\r\napt update\r\napt install 'docker-ce=18.06.1~ce~3-0~ubuntu' -y\r\napt install docker-ce-cli containerd.io -y\r\nsystemctl start docker\r\nsystemctl enable docker\r\n\r\n# install kubernetes\r\napt install -y kubelet kubeadm kubectl kubernetes-cni\r\nmkdir -p /etc/cni/net.d \r\ncat \u003e /etc/cni/net.d/10-flannel.conflist \u003c\u003cEOF \r\n{ \"name\": \"cbr0\", \"plugins\": [ { \"type\": \"flannel\", \"delegate\": { \"hairpinMode\": true, \"isDefaultGateway\": true } }, { \"type\": \"portmap\", \"capabilities\": { \"portMappings\": true } } ] }\r\nEOF\r\nsystemctl start kubelet\r\nsystemctl enable kubelet\r\n\r\n# join nodes to cluster\r\nkubeadm join --token ${KUBEADM_TOKEN} ${MASTER_IP}:6443 --discovery-token-unsafe-skip-ca-verification\r\n\r\nsystemctl restart kubelet",
                            "vars.%": "2",
                            "vars.KUBEADM_TOKEN": "abcdef.0123456789abcdef",
                            "vars.MASTER_IP": "99.79.45.252"
                        },
                        "meta": {},
                        "tainted": false
                    },
                    "deposed": [],
                    "provider": "provider.template"
                }
            },
            "depends_on": []
        }
    ]
}
